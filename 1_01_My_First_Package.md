# My First Package

## Содержание

- [Содержание](#содержание)
- [Привет](#привет)
- [Почему пакеты - это важно?](#почему-пакеты---это-важно)
- [Как мне создать локальный workspace?](#как-мне-создать-локальный-workspace)
- [Готовим тарелку](#готовим-тарелку)
- [Чему научились?](#чему-научились)
- [Задачки](#задачки)
- [Вопросики](#вопросики)

## Привет

До этого момента мы запускали уже готовые программы в разных терминалах, чтобы всё работало. Давай теперь начнём организовывать своё рабочее место, чтобы творить свои интересные штуки!

Например, мы достаточно накатались с черепашкой и хотим сделать своего робота в симуляторе. Робота, который приносит холодные напитки из холодильника! Это же надо не только уметь двигаться к цели, но и управлять манипуляторами (руками робота), а на черепашке такого нету =( Остаётся только творить самим!

Или нам подходит черепашка, но хочется для построения карты использовать другой датчик/другую программу для картографирования.

Или, у нас уже есть робот в реальном мире, но с ним опасно/долго постоянно работать (заряжать приходится, возвращать на начальную точку и т.д.) и мы хотим сделать в симуляторе, чтобы настраивать программы и тестировать работу программ на роботе!

Или...

В практике можно встретить очень много ситуаций, когда нам нужно сделать что-то своё, используя готовые решения (модифицировать их) или совсем с нуля создать. Для этого нам надо познакомиться с понятиями **пакета** и **рабочего пространства (workspace)** в ROS.

## Почему пакеты - это важно?

Представь себе огромный шведский стол! На нём есть разные блюда разной кухни - роллы, пицца, хинкали, борщ и т.д.

Обычно, мы привыкли приходить к столу с подносом, накладывать на тарелки блюда (не смешивая их!) и потом с тарелками на подносе идти за стол. Отлично, на минутку представим вкусный стол, как мы отведаем еду и, если голод напомнил о себе - сходи покушай =)

<p align="center">
<img src=../assets/where_are_you.jpg />
</p>

Мы можем продолжать? =)

Так вот давай теперь представим легкую альтернативу:

- Блюдо - это полезные материалы, модели в симуляторе, программы, чего там только нету.
- Тарелка - это **пакет**, мы на него накладываем конкретное блюдо, но не смешиваем с другими, потому что будет невкусно!
- Твой стол - это рабочее пространство, на котором размещаются тарелки и ведётся работа (кушаем-с).

По сути, главная суть аналогии в том, что по пакетам мы раскладываем материалы (коды программ, конфигурации, описания, модели в симуляторе) по разным темам, чтобы не скидывать всё в кучу. Если сложить в кучу, то потом замучаемся разбираться, что и где находится!

То есть, если мы хотим сделать своего робота, то мы может создать отдельный пакет для робота, при этом материалы по другим роботам будут лежать в отдельных пакетах!

Если в нашем роботе есть: телеуправление, навигация, построение карты, то можно сложить это в отдельные пакеты (как, например, у черепашки turtlebot3_teleop, turtlebot3_navigation, turtlebot3_slam).

Рабочее пространство в свою очередь просто объединяет пакеты в себе в системе (на диске).

> Первое время мы будем работать только с двумя рабочими пространствами. С первым уже знакомы - системное, в него устанавливаются все пакеты, которые мы ставим через `sudo apt install ros-noetic-...`. Второе, с которым будем работать - локальное. Там хранятся пакеты, которые мы пишем сами или собираем из исходников.

Надеюсь, важность организации кода и материалов по пакетам понятна? Есть и альтернативный путь - можете создать для всех своих работ единственный пакет и все складывать в него, но потом на своем опыте поймёте, почему такой подход сложен в работе по мере роста проекта =)

## Как мне создать локальный workspace?

> Чуть подготовимся, поставим `catkin` инструмент сборки командой `sudo apt install python3-catkin-tools`

Так, ну если в системном пространстве мы уже запускали пакеты, то где находится локальное?

А его ещё нету =) Его надо создать!

Сделаем это, по общей практике это делается в домашней директории пользователя:

```bash
mkdir $HOME/catkin_ws
```

> Если вы не понимаете, что делает команда `mkdir` или что значит `$HOME` - прочитайте [Shell топик](0_01_Shell.md) в нулевом разделе.

Так мы создадим директорию `catkin_ws` - это и будет нашим локальным (ещё можно назвать пользовательским, так как у каждого пользователя в системе будет своё) пространством.

Но пока это не пространство, а просто папка, давайте сделаем всё, чтобы её инициализировать!

```bash
# Go внутрь
cd ~/catkin_ws
# Стартуем инициализацию
catkin init
```

И должны увидеть что-то наподобии:

```console
Initializing catkin workspace in `/home/user/catkin_ws`.
------------------------------------------------------------------
Profile:                     default
Extending:             [env] /opt/ros/noetic
Workspace:                   /home/user/catkin_ws
------------------------------------------------------------------
Build Space:       [missing] /home/user/catkin_ws/build
Devel Space:       [missing] /home/user/catkin_ws/devel
Install Space:      [unused] /home/user/catkin_ws/install
Log Space:         [missing] /home/user/catkin_ws/logs
Source Space:      [missing] /home/user/catkin_ws/src
DESTDIR:            [unused] None
------------------------------------------------------------------
Devel Space Layout:          linked
Install Space Layout:        None
------------------------------------------------------------------
Additional CMake Args:       None
Additional Make Args:        None
Additional catkin Make Args: None
Internal Make Job Server:    True
Cache Job Environments:      False
------------------------------------------------------------------
Buildlisted Packages:        None
Skiplisted Packages:         None
------------------------------------------------------------------
Workspace configuration appears valid.
------------------------------------------------------------------

------------------------------------------------------------------
WARNING: Source space `/home/user/catkin_ws/src` does
not yet exist.
------------------------------------------------------------------
```

Шикарно! У нас есть рабочее пространство!

Ай-да теперь создавать наш первый пакет в этом пространстве!

## Готовим тарелку

Отлично, пространство мы создали, теперь сделаем свой пакет.

Первое, что нужно сделать - это создать директорию `src` внутри пространства:

```bash
# Обязательно внутри catkin_ws
mkdir src
# Ии заходим внутрь
cd src
```

Теперь создаём пакет с названием `super_robot_package`:

> Если хочешь, можешь создать пакет со своим названием, но дальше тогда придется во всех командах заменять имя.

```bash
catkin create pkg super_robot_package
```

В выводе должен получиться подобный вывод:

```bash
Creating package "super_robot_package" in "/home/user/catkin_ws/src"...
Created file super_robot_package/package.xml
Created file super_robot_package/CMakeLists.txt
Successfully created package files in /home/user/catkin_ws/src/super_robot_package.
```

После создания пакета очень важно его собрать! Для этого используем команду для сборки:

```bash
catkin build super_robot_package
```

В выводе увидите что-то такое:

```bash
NOTE: Forcing CMake to run for each package.
-----------------------------------------------------------
[build] Found 1 packages in 0.0 seconds.
[build] Updating package.
Starting  >>> catkin_tools_prebuild
Finished  <<< catkin_tools_prebuild                [ 2.1 seconds ]
Starting  >>> super_robot_package
Finished  <<< super_robot_package                  [ 1.9 seconds ]
[build] Summary: All 2 packages succeeded!                                                                                                                                                                         
```

Отлично! Как нам теперь проверить, что система ROS видит наш пакет? Познакомимся с утилитой, которая работает с пакетами системы ROS - `rospack`!

```bash
# Посмотрим список пакетов в системе
rospack list
```

В выводе видим:

```bash
...
turtlebot3_gazebo /opt/ros/noetic/share/turtlebot3_gazebo
turtlebot3_msgs /opt/ros/noetic/share/turtlebot3_msgs
turtlebot3_navigation /opt/ros/noetic/share/turtlebot3_navigation
turtlebot3_slam /opt/ros/noetic/share/turtlebot3_slam
turtlebot3_teleop /opt/ros/noetic/share/turtlebot3_teleop
turtlesim /opt/ros/noetic/share/turtlesim
urdf /opt/ros/noetic/share/urdf
urdf_parser_plugin /opt/ros/noetic/share/urdf_parser_plugin
urdf_sim_tutorial /opt/ros/noetic/share/urdf_sim_tutorial
urdf_tutorial /opt/ros/noetic/share/urdf_tutorial
visualization_marker_tutorials /opt/ros/noetic/share/visualization_marker_tutorials
visualization_msgs /opt/ros/noetic/share/visualization_msgs
voxel_grid /opt/ros/noetic/share/voxel_grid
webkit_dependency /opt/ros/noetic/share/webkit_dependency
xacro /opt/ros/noetic/share/xacro
xmlrpcpp /opt/ros/noetic/share/xmlrpcpp
```

Но в этом выводе тяжело искать, давайте отфильтруем этот список, поискав наш пакет:

```bash
rospack list | grep super_robot_package
```

Хм.. Ничего? То есть, наш пакет не видно? Давайте посмотрим, где ROS ищет пакеты с помощью переменной окружения `ROS_PACKAGE_PATH`:

```bash
echo $ROS_PACKAGE_PATH
# /opt/ros/noetic/share
```

Ага, такс, а как заставить ROS искать пакеты в нашем WS (workspace)? Нужно сделать похожее с тем, что мы делали, когда устанавливали ROS.

Для системного пространства мы использовали команду `source /opt/ros/noetic/setup.bash`

Для локального WS мы используем команду:

```bash
source $HOME/catkin_ws/devel/setup.bash
```

После её выполнения проверь наличие пакета!

```bash
rospack list | grep super_robot_package
# super_robot_package /home/user/catkin_ws/src/super_robot_package
```

Оп, вот и пакет нашёлся, значит он теперь учитывается в системе ROS.

:muscle: Убедись с помощью проверки переменной ROS_PACKAGE_PATH, где ищутся теперь пакеты.

> Но ведь команда `source` работает только для нынешней сессии shell, чтобы она вызывалась в каждом терминале, как обычно, прописывай в `~/.bashrc` руками или командой `echo "source \$HOME/catkin_ws/devel/setup.bash" >> ~/.bashrc`.

## Чему научились?

- Теперь мы можем создавать локальное рабочее пространство (WS)
- Подключать WS в систему ROS, чтобы учитывались пакеты внутри
- А ещё создать в нем пакеты
- Собирать пакеты
- И с помощью `rospack` выводить список пакетов и искать по ним!

Молодцы, круто!

## Задачки

- Как с помощью утилиты `rospack` определять путь до конкретного пакета, не используя grep? Подсказка, все команды `rospack` можно посмотреть с помощью `rospack -h`.
- Определите расположение пакетов `turtlebot3_gazebo` и других, которые мы ранее использовали.
- Мы знаем, что WS находится по пути `~/catkin_ws/src` и можем перейти в пакеты внутри, но что если пакеты где-то в другом месте? Воспользуйтесь утилитой `roscd` и разберитесь, как перейти в директорию пакета с помощью этой команды.

## Вопросики

- Зачем нужно рабочие пространства и пакеты в ROS?
- Как нужно организовывать исходные коды программ и материалы по пакетам?
- Какими командами создаётся рабочее пространство? Что нужно сделать после его создания?
- Какие этапы создания пакета в рабочем пространстве?
- В какой переменной находятся пути, по которым ROS ищет пакеты?
